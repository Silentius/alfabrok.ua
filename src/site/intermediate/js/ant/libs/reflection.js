(function(b){b.fn.extend({reflect:function(e){e=b.extend({height:1/3,opacity:0.5},e);return this.unreflect().each(function(){var a=this;if(/^img$/i.test(a.tagName)){var j=function(){var h=a.width,f=a.height,c,g,d,i;g=Math.floor(e.height>1?Math.min(f,e.height):f*e.height);if(b.browser.msie)c=b("<img />").attr("src",a.src).css({width:h,height:f,marginBottom:g-f,filter:"flipv progid:DXImageTransform.Microsoft.Alpha(opacity="+e.opacity*100+", style=1, finishOpacity=0, startx=0, starty=0, finishx=0, finishy="+
g/f*100+")"})[0];else{c=b("<canvas />")[0];if(!c.getContext)return;d=c.getContext("2d");try{b(c).attr({width:h,height:g}),d.save(),d.translate(0,f-1),d.scale(1,-1),d.drawImage(a,0,0,h,f),d.restore(),d.globalCompositeOperation="destination-out",i=d.createLinearGradient(0,0,0,g),i.addColorStop(0,"rgba(255, 255, 255, "+(1-e.opacity)+")"),i.addColorStop(1,"rgba(255, 255, 255, 1.0)"),d.fillStyle=i,d.rect(0,0,h,g),d.fill()}catch(j){return}}b(c).css({display:"block",border:0});c=b(/^a$/i.test(a.parentNode.tagName)?
"<span />":"<div />").insertAfter(a).append([a,c])[0];c.className=a.className;b.data(a,"reflected",c.style.cssText=a.style.cssText);b(c).css({width:h,height:f+g,overflow:"hidden"});a.style.cssText="display: block; border: 0px";a.className="reflected"};a.complete?j():b(a).load(j)}})},unreflect:function(){return this.unbind("load").each(function(){var e=b.data(this,"reflected"),a;if(e!==void 0)a=this.parentNode,this.className=a.className,this.style.cssText=e,b.removeData(this,"reflected"),a.parentNode.replaceChild(this,
a)})}})})(jQuery);
