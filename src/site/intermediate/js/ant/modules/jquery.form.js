(function(c){c.fn.ajaxSubmit=function(a){function f(){function b(){if(!o++){k.detachEvent?k.detachEvent("onload",b):k.removeEventListener("load",b,!1);var a=!0;try{if(n)throw"timeout";var e,g;g=k.contentWindow?k.contentWindow.document:k.contentDocument?k.contentDocument:k.document;j.responseText=g.body?g.body.innerHTML:null;j.responseXML=g.XMLDocument?g.XMLDocument:g;j.getResponseHeader=function(a){return{"content-type":d.dataType}[a]};if(d.dataType=="json"||d.dataType=="script"){var h=g.getElementsByTagName("textarea")[0];
j.responseText=h?h.value:j.responseText}else if(d.dataType=="xml"&&!j.responseXML&&j.responseText!=null)j.responseXML=f(j.responseText);e=c.httpData(j,d.dataType)}catch(q){a=!1,c.handleError(d,j,"error",q)}a&&(d.success(e,"success"),l&&c.event.trigger("ajaxSuccess",[j,d]));l&&c.event.trigger("ajaxComplete",[j,d]);l&&!--c.active&&c.event.trigger("ajaxStop");d.complete&&d.complete(j,a?"success":"error");setTimeout(function(){i.remove();j.responseXML=null},100)}}function f(a,b){window.ActiveXObject?
(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml");return b&&b.documentElement&&b.documentElement.tagName!="parsererror"?b:null}var e=h[0],d=c.extend({},c.ajaxSettings,a),g="jqFormIO"+(new Date).getTime(),i=c('<iframe id="'+g+'" name="'+g+'" />'),k=i[0],r=c.browser.opera&&window.opera.version()<9;if(c.browser.msie||r)k.src='javascript:false;document.write("");';i.css({position:"absolute",top:"-1000px",left:"-1000px"});var j={responseText:null,
responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){}},l=d.global;l&&!c.active++&&c.event.trigger("ajaxStart");l&&c.event.trigger("ajaxSend",[j,d]);var o=0,n=0;setTimeout(function(){var a=e.encoding?"encoding":"enctype",c=h.attr("target"),f=h.attr("action");h.attr({target:g,method:"POST",action:d.url});e[a]="multipart/form-data";d.timeout&&setTimeout(function(){n=!0;b()},d.timeout);i.appendTo("body");k.attachEvent?
k.attachEvent("onload",b):k.addEventListener("load",b,!1);e.submit();h.attr({action:f,target:c})},10)}typeof a=="function"&&(a={success:a});var a=c.extend({url:this.attr("action")||window.location.toString(),type:this.attr("method")||"GET"},a||{}),b={};this.trigger("form-pre-serialize",[this,a,b]);if(b.veto)return this;var e=this.formToArray(a.semantic);if(a.data)for(var d in a.data)e.push({name:d,value:a.data[d]});if(a.beforeSubmit&&a.beforeSubmit(e,this,a)===!1)return this;this.trigger("form-submit-validate",
[e,this,a,b]);if(b.veto)return this;b=c.param(e);a.type.toUpperCase()=="GET"?(a.url+=(a.url.indexOf("?")>=0?"&":"?")+b,a.data=null):a.data=b;var h=this,g=[];a.resetForm&&g.push(function(){h.resetForm()});a.clearForm&&g.push(function(){h.clearForm()});if(!a.dataType&&a.target){var i=a.success||function(){};g.push(function(b){c(a.target).html(b).each(i,arguments)})}else a.success&&g.push(a.success);a.success=function(a,b){for(var c=0,d=g.length;c<d;c++)g[c](a,b,h)};b=c("input:file",this).fieldValue();
e=!1;for(d=0;d<b.length;d++)b[d]&&(e=!0);a.iframe||e?c.browser.safari&&a.closeKeepAlive?c.get(a.closeKeepAlive,f):f():c.ajax(a);this.trigger("form-submit-notify",[this,a]);return this};c.fn.ajaxForm=function(a){return this.ajaxFormUnbind().bind("submit.form-plugin",function(){c(this).ajaxSubmit(a);return!1}).each(function(){c(":submit,input:image",this).bind("click.form-plugin",function(a){var b=this.form;b.clk=this;if(this.type=="image")if(a.offsetX!=void 0)b.clk_x=a.offsetX,b.clk_y=a.offsetY;else if(typeof c.fn.offset==
"function"){var e=c(this).offset();b.clk_x=a.pageX-e.left;b.clk_y=a.pageY-e.top}else b.clk_x=a.pageX-this.offsetLeft,b.clk_y=a.pageY-this.offsetTop;setTimeout(function(){b.clk=b.clk_x=b.clk_y=null},10)})})};c.fn.ajaxFormUnbind=function(){this.unbind("submit.form-plugin");return this.each(function(){c(":submit,input:image",this).unbind("click.form-plugin")})};c.fn.formToArray=function(a){var f=[];if(this.length==0)return f;var b=this[0],e=a?b.getElementsByTagName("*"):b.elements;if(!e)return f;for(var d=
0,h=e.length;d<h;d++){var g=e[d],i=g.name;if(i)if(a&&b.clk&&g.type=="image")!g.disabled&&b.clk==g&&f.push({name:i+".x",value:b.clk_x},{name:i+".y",value:b.clk_y});else if((g=c.fieldValue(g,!0))&&g.constructor==Array)for(var m=0,p=g.length;m<p;m++)f.push({name:i,value:g[m]});else g!==null&&typeof g!="undefined"&&f.push({name:i,value:g})}if(!a&&b.clk){a=b.getElementsByTagName("input");d=0;for(h=a.length;d<h;d++)e=a[d],(i=e.name)&&!e.disabled&&e.type=="image"&&b.clk==e&&f.push({name:i+".x",value:b.clk_x},
{name:i+".y",value:b.clk_y})}return f};c.fn.formSerialize=function(a){return c.param(this.formToArray(a))};c.fn.fieldSerialize=function(a){var f=[];this.each(function(){var b=this.name;if(b){var e=c.fieldValue(this,a);if(e&&e.constructor==Array)for(var d=0,h=e.length;d<h;d++)f.push({name:b,value:e[d]});else e!==null&&typeof e!="undefined"&&f.push({name:this.name,value:e})}});return c.param(f)};c.fn.fieldValue=function(a){for(var f=[],b=0,e=this.length;b<e;b++){var d=c.fieldValue(this[b],a);d===null||
typeof d=="undefined"||d.constructor==Array&&!d.length||(d.constructor==Array?c.merge(f,d):f.push(d))}return f};c.fieldValue=function(a,f){var b=a.name,e=a.type,d=a.tagName.toLowerCase();typeof f=="undefined"&&(f=!0);if(f&&(!b||a.disabled||e=="reset"||e=="button"||(e=="checkbox"||e=="radio")&&!a.checked||(e=="submit"||e=="image")&&a.form&&a.form.clk!=a||d=="select"&&a.selectedIndex==-1))return null;if(d=="select"){var h=a.selectedIndex;if(h<0)return null;for(var b=[],d=a.options,g=(e=e=="select-one")?
h+1:d.length,h=e?h:0;h<g;h++){var i=d[h];if(i.selected){i=c.browser.msie&&!i.attributes.value.specified?i.text:i.value;if(e)return i;b.push(i)}}return b}return a.value};c.fn.clearForm=function(){return this.each(function(){c("input,select,textarea",this).clearFields()})};c.fn.clearFields=c.fn.clearInputs=function(){return this.each(function(){var a=this.type,c=this.tagName.toLowerCase();if(a=="text"||a=="password"||c=="textarea")this.value="";else if(a=="checkbox"||a=="radio")this.checked=!1;else if(c==
"select")this.selectedIndex=-1})};c.fn.resetForm=function(){return this.each(function(){(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType)&&this.reset()})};c.fn.enable=function(a){a==void 0&&(a=!0);return this.each(function(){this.disabled=!a})};c.fn.select=function(a){a==void 0&&(a=!0);return this.each(function(){var f=this.type;if(f=="checkbox"||f=="radio")this.checked=a;else if(this.tagName.toLowerCase()=="option")f=c(this).parent("select"),a&&f[0]&&f[0].type=="select-one"&&
f.find("option").select(!1),this.selected=a})}})(jQuery);
